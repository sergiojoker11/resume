---
import { Icon } from 'astro-icon/components';
import jsonHeader from "../EDIT_ME/user_info.json";
import DropdownMenu from './DropdownMenu.astro';

const iconSizeNormal = 20;
const iconSize2XL = 25;
const downloadLabel = "Download resume";
const toggleLabel = "Toggle theme";
const dropdownLabel = "Navigation";

---
<script>
  function download() {
    const resumeContent = document.getElementById('resume-wrapper');
    if (!resumeContent) return;

    const iframe = document.createElement('iframe');
    iframe.style.position = 'absolute';
    iframe.style.width = '0';
    iframe.style.height = '0';
    iframe.style.border = 'none';
    document.body.appendChild(iframe);

    const iframeDoc = iframe.contentWindow?.document;
    if (!iframeDoc) return;

    // Copy all stylesheets
    const styles = Array.from(document.querySelectorAll('link[rel="stylesheet"], style'))
      .map(el => el.outerHTML)
      .join('');

    iframeDoc.open();
    iframeDoc.write(`
      <!DOCTYPE html>
      <html class="${document.documentElement.className}">
        <head>${styles}</head>
        <body style="padding: 2rem;">${resumeContent.innerHTML}</body>
      </html>
    `);
    iframeDoc.close();

    iframe.contentWindow?.focus();
    iframe.contentWindow?.print();

    setTimeout(() => iframe.remove(), 1000);
  }

  const downloadButton = document.querySelector('#download') as Element;
  downloadButton.addEventListener('click', () => {
    download();
  });
</script>
<div id="navbar" class="pt-[1rem] px-[1rem] md:p-0">
  <div class = "flex flex-row items-end mb-3 gap-x-2">
    <div class="flex-auto">
      <button id = "dropdown-button" class = "button" title={dropdownLabel} aria-label={dropdownLabel}>
        <div class="iconLabel">
          <div class="hidden sm:block">Jump to</div>
          <div id = "dropdown-icon-down">
            <Icon class = "2xl:hidden" name="mdi:arrow-down-drop" size={iconSizeNormal} />
            <Icon class = "hidden 2xl:block" name="mdi:arrow-down-drop" size={iconSize2XL} />
          </div>
          <div id = "dropdown-icon-up" class = "hidden">
            <Icon class = "2xl:hidden" name="mdi:arrow-drop-up" size={iconSizeNormal} />
            <Icon class = "hidden 2xl:block" name="mdi:arrow-drop-up" size={iconSize2XL} />
          </div>
        </div>
      </button>
      <DropdownMenu />
    </div>

    <a title={downloadLabel} id="download" aria-label={downloadLabel}>
      <button class = "button">
        <div class="iconLabel">
          <div class="hidden sm:block">Download</div>
          <Icon class = "2xl:hidden" name="mdi:download" size={iconSizeNormal} />
          <Icon class = "hidden 2xl:block" name="mdi:download" size={iconSize2XL} />
        </div>
      </button> 
    </a>

    <button title={toggleLabel} class = "button" id="themeToggle" aria-label={toggleLabel}>
      <Icon class = "2xl:hidden" name="mdi:sun-moon-stars" size={iconSizeNormal} />
      <Icon class = "hidden 2xl:block" name="mdi:sun-moon-stars" size={iconSize2XL} />
    </button>
</div>